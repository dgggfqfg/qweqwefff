function [Vi, V, Vindex] = Vulnerability_bin(Mat, isdir, E)
% [Vi, V] = Vulnerability(Mat,E)
% ...calculates vulnerability Vi of a node i as the
% drop in network performance when node i and its connections are removed

% Mat= Binary inputmatrix , size NxN, N=number of channels
% E= Eglob= Global efficiency: how efficiently information can be exchanged
%    over network
% V= Vulnerability, size 1xN, N= number of channels

N = size(Mat, 1);

Vi = zeros(N, 1);
for node = 1: N
    aux_Mat = Mat;
    aux_Mat(node, :) = [];
    aux_Mat(:, node) = []; 
    aux_D = distance_bin(aux_Mat);
    Ei = Efficiency_bin(aux_Mat, isdir, aux_D);
    Vi(node) = (E - Ei) / E;
end

if nargout > 1
    [V,Vindex] = max(Vi);
end;